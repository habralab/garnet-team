- id: auth
  upstream:
    url: http://identity:3000/
  match:
    url: https://stage.garnet.pet-project.habr.com/<(?!app|admin).*>
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
  authenticators:
    - handler: anonymous
  authorizer:
    handler: allow
  mutators:
    - handler: noop
  errors:
    - handler: json

- id: app
  upstream:
    url: http://app:3001/
  match:
    url: https://stage.garnet.pet-project.habr.com/<.*>
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
  authenticators:
    - handler: cookie_session
  authorizer:
    handler: allow
  mutators:
    - handler: id_token
  errors:
    - handler: redirect
